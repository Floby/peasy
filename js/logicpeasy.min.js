var exports,module,require,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;"object"==typeof window&&(_ref=twoside("/logicpeasy"),require=_ref.require,exports=_ref.exports,module=_ref.module),function(require,exports){var BindingError,Cons,DummyVar,Error,Parser,Trail,UArray,UObject,Var,dummy,nameToIndexMap,peasy,reElements,uarray,_ref1;return peasy=require("./peasy"),exports.Parser=Parser=function(_super){function Parser(){var self;Parser.__super__.constructor.apply(this,arguments),self=this,this.parse=function(data,root,cur){return null==root&&(root=self.root),null==cur&&(cur=0),self.data=data,self.cur=cur,self.trail=new Trail,self.ruleStack={},self.cache={},root()},this.bind=function(vari,term){return vari.bind(self.trail.deref(term)),!0},this.unify=function(x,y,equal){return null==equal&&(equal=function(x,y){return x===y}),self.trail.unify(x,y,equal)},this.unifyList=function(xs,ys,equal){var i,xlen,_i,_unify;if(null==equal&&(equal=function(x,y){return x===y}),xlen=xs.length,ys.length!==xlen)return!1;for(_unify=self.trail.unify,i=_i=0;xlen>=0?xlen>_i:_i>xlen;i=xlen>=0?++_i:--_i)if(!_unify(xs[i],ys[i],equal))return!1;return!0},this.orp=function(){var item,items;return items=1<=arguments.length?__slice.call(arguments,0):[],items=function(){var _i,_len,_results;for(_results=[],_i=0,_len=items.length;_len>_i;_i++)item=items[_i],_results.push("string"==typeof item?self.literal(item):item);return _results}(),function(){var i,length,result,start,_i;for(start=self.cur,length=items.length,i=_i=0;length>=0?length>_i:_i>length;i=length>=0?++_i:--_i){if(self.cur=start,self.trail=new Trail,result=items[i]())return result;i!==length-1&&self.trail.undo()}return result}},this.unifyChar=function(x){return function(){var c;return x=self.trail.deref(x),x instanceof Var?(c=self.data[self.cur++],x.bind(c),c):self.data[self.cur]===x?(self.cur++,x):void 0}},this.unifyDigit=function(x){return function(){var c;if(c=self.data[self.cur],c>="0"&&"9">=c){if(x=self.trail.deref(x),x instanceof Var)return self.cur++,x.bind(c),c;if(x===c)return self.cur++,c}}},this.unifyLetter=function(x){return function(){var c;if(c=self.data[self.cur],x>="a"&&"z">=x||x>="A"&&"Z">=x){if(x=self.trail.deref(x),x instanceof Va)return x.bind(c),self.cur++,c;if(x===c)return self.cur++,c}}},this.unifyLower=function(x){return function(){var c;if(c=self.data[self.cur],x>="a"&&"z">=x){if(x=self.trail.deref(x),x instanceof Var)return x.bind(c),self.cur++,c;if(x===c)return self.cur++,c}}},this.unifyUpper=function(x){return function(){var c;if(c=self.data[self.cur],x>="A"&&"Z">=x){if(x=self.trail.deref(x),x instanceof Var)return x.bind(c),self.cur++,c;if(x===c)return self.cur++,c}}},this.unifyIdentifier=function(x){return function(){var n;return(n=self.identifier()&&self.unify(x,n))?n:void 0}}}return __extends(Parser,_super),Parser}(peasy.Parser),exports.Error=Error=function(){function Error(exp,message,stack){this.exp=exp,this.message=null!=message?message:"",this.stack=null!=stack?stack:this}return Error.prototype.toString=function(){return""+this.constructor.name+": "+this.exp+" >>> "+this.message},Error}(),exports.BindingError=BindingError=function(_super){function BindingError(){return _ref1=BindingError.__super__.constructor.apply(this,arguments)}return __extends(BindingError,_super),BindingError}(Error),exports.Trail=Trail=function(){function Trail(data){this.data=null!=data?data:{}}return Trail.prototype.copy=function(){return new Trail(_.extend({},this.data))},Trail.prototype.set=function(vari,value){var data;return data=this.data,data.hasOwnProperty(vari.name)?void 0:data[vari.name]=[vari,value]},Trail.prototype.undo=function(){var nam,pair,_ref2,_results;_ref2=this.data,_results=[];for(nam in _ref2)pair=_ref2[nam],_results.push(pair[0].binding=pair[1]);return _results},Trail.prototype.deref=function(x){return(null!=x?"function"==typeof x.deref?x.deref(this):void 0:void 0)||x},Trail.prototype.getvalue=function(x,memo){var getvalue;return null==memo&&(memo={}),getvalue=null!=x?x.getvalue:void 0,getvalue?getvalue.call(x,this,memo):x},Trail.prototype.unify=function(x,y,equal){return x=this.deref(x),y=this.deref(y),x instanceof Var?(this.set(x,x.binding),x.binding=y,!0):y instanceof Var?(this.set(y,y.binding),y.binding=x,!0):(null!=x?"function"==typeof x.unify?x.unify(y,this):void 0:void 0)||(null!=y?"function"==typeof y.unify?y.unify(x,this):void 0:void 0)||equal(x,y)},Trail}(),exports.Var=Var=function(){function Var(name,binding){this.name=null!=name?name:"",this.binding=null!=binding?binding:this}return Var.prototype.deref=function(trail){var chains,i,length,next,v,x,_i,_j,_ref2,_ref3;if(v=this,next=this.binding,!(next!==this&&next instanceof Var))return next;for(chains=[v],length=1;;){if(chains.push(next),v=next,next=v.binding,length++,next===v){for(i=_i=0,_ref2=chains.length-2;_ref2>=0?_ref2>_i:_i>_ref2;i=_ref2>=0?++_i:--_i)x=chains[i],x.binding=next,trail.set(x,chains[i+1]);return next}if(!(next instanceof Var)){for(i=_j=0,_ref3=chains.length-1;_ref3>=0?_ref3>_j:_j>_ref3;i=_ref3>=0?++_j:--_j)x=chains[i],x.binding=next,trail.set(x,chains[i+1]);return next}}},Var.prototype.bind=function(value,trail){return trail.set(this,this.binding),this.binding=trail.deref(value)},Var.prototype.getvalue=function(trail,memo){var name,result;return null==memo&&(memo={}),name=this.name,memo.hasOwnProperty(name)?memo[name]:(result=this.deref(trail),result instanceof Var?(memo[name]=result,result):(result=trail.getvalue(result,memo),memo[name]=result,result))},Var.prototype.toString=function(){return"vari("+this.name+")"},Var}(),reElements=/\s*,\s*|\s+/,nameToIndexMap={},exports.vari=function(name){var index;return null==name&&(name=""),index=nameToIndexMap[name]||1,nameToIndexMap[name]=index+1,new Var(name+index)},exports.vars=function(names){var name,_i,_len,_ref2,_results;for(_ref2=split(names,reElements),_results=[],_i=0,_len=_ref2.length;_len>_i;_i++)name=_ref2[_i],_results.push(vari(name));return _results},exports.DummyVar=DummyVar=function(_super){function DummyVar(name){this.name="_$"+name}return __extends(DummyVar,_super),DummyVar.prototype.deref=function(){return this},DummyVar.prototype.getvalue=function(trail,memo){var name,result;return null==memo&&(memo={}),name=this.name,memo.hasOwnProperty(name)?memo[name]:(result=this.binding,result===this?(memo[name]=result,result):(result=trail.getvalue(result,memo),memo[name]=result,result))},DummyVar}(Var),exports.dummy=dummy=function(name){var index;return index=nameToIndexMap[name]||1,nameToIndexMap[name]=index+1,new exports.DummyVar(name+index)},exports.dummies=function(names){var name,_i,_len,_ref2,_results;for(_ref2=split(names,reElements),_results=[],_i=0,_len=_ref2.length;_len>_i;_i++)name=_ref2[_i],_results.push(new dummy(name));return _results},exports.UObject=UObject=function(){function UObject(data){this.data=data}return UObject.prototype.getvalue=function(trail,memo){var changed,key,result,v,value,_ref2;result={},changed=!1,_ref2=this.data;for(key in _ref2)value=_ref2[key],v=trail.getvalue(value,memo),v!==value&&(changed=!0),result[key]=v;return changed?new UObject(result):this},UObject.prototype.unify=function(y,trail,equal){var index,key,xdata,ydata,ykeys;null==equal&&(equal=function(x,y){return x===y}),xdata=this.data,ydata=y instanceof UObject?y.data:y,ykeys=Object.keys(y);for(key in xdata){if(index=ykeys.indexOf(key),-1===index)return!1;if(!trail.unify(xdata[key],ydata[key],equal))return!1;ykeys.splice(index,1)}return 0!==ykeys.length?!1:!0},UObject}(),exports.uobject=function(x){return new UObject(x)},exports.UArray=UArray=function(){function UArray(data){this.data=data}return UArray.prototype.getvalue=function(trail,memo){var changed,result,v,x,_i,_len,_ref2;for(null==memo&&(memo={}),result=[],changed=!1,_ref2=this.data,_i=0,_len=_ref2.length;_len>_i;_i++)x=_ref2[_i],v=trail.getvalue(x,memo),v!==x&&(changed=!0),result.push(v);return changed?new UArray(result):this},UArray.prototype.unify=function(y,trail,equal){var i,length,xdata,ydata,_i;if(null==equal&&(equal=function(x,y){return x===y}),xdata=this.data,ydata=y.data||y,length=this.data.length,length!==y.length)return!1;for(i=_i=0;length>=0?length>_i:_i>length;i=length>=0?++_i:--_i)if(!trail.unify(xdata[i],ydata[i],equal))return!1;return!0},UArray.prototype.toString=function(){return this.data.toString()},UArray}(),exports.uarray=uarray=function(x){return new UArray(x)},exports.Cons=Cons=function(){function Cons(head,tail){this.head=head,this.tail=tail}return Cons.prototype.getvalue=function(trail,memo){var head,head1,tail,tail1;return null==memo&&(memo={}),head=this.head,tail=this.tail,head1=trail.getvalue(head,memo),tail1=trail.getvalue(tail,memo),head1===head&&tail1===tail?this:new Cons(head1,tail1)},Cons.prototype.unify=function(y,trail,equal){return null==equal&&(equal=function(x,y){return x===y}),y instanceof Cons?trail.unify(this.head,y.head,equal)?trail.unify(this.tail,y.tail,equal):!1:!1},Cons.prototype.flatString=function(){var result,tail;return result=""+this.head,tail=this.tail,null===tail||(tail instanceof Cons?(result+=",",result+=tail.flatString()):result+=tail.toString()),result},Cons.prototype.toString=function(){return"cons("+this.head+", "+this.tail+")"},Cons}(),exports.cons=function(x,y){return new Cons(x,y)},exports.conslist=function(){var args,i,result,_i,_ref2;for(args=1<=arguments.length?__slice.call(arguments,0):[],result=null,i=_i=_ref2=args.length-1;_i>=0;i=_i+=-1)result=new Cons([args[i],result]);return result},exports.unifiable=function(x){return _.isArray(x)?new UArray(x):_.isObject(x)?new UObject(x):x}}(require,exports,module);