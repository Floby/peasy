<!DOCTYPE html>

<html>
<head>
  <title>Peasy</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>Peasy</h1>
<h6>Peasy means parsing is easy</h6>
<h6>an easy but powerful parser</h6>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>To use Peasy, just require or copy this file to your project, read it, modify it, write the grammar rules,, and
remove any unnecessary stuffs in it, and parse with the data.@<br/>
See <a href="#peasysample">here</a> for a sample grammar in Peasy.<br/></p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>With Peasy, you write the parser by hand, just like to write any other kind of program.<br/>
You need not play many balls like that any more: <br/><br/>
<img src="https://raw.github.com/chaosim/peasy/master/doc/ballacrobatics.jpg" alt="ballacrobatics.jpg"><br/>
You just play one ball like so: <br/><br/>
<img src="https://raw.github.com/chaosim/peasy/master/doc/dolphinball.jpg" alt="dolphinball.jpg"><br/>,</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>You can embeded other features in the grammar rules seamless, such as lexer, rewriter, semantic action, error
process or any other tasks; you can dynamicly modify the grammar rules, even the parsed object, if you wish.<br/></p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Instead of a tool or a library, Peasy is rather a new method to write parser. As a demonstration, Peasy presents
itself as a module of single file, which includes some functions to process left recursives symbols, some matchers
which parse text, and some matchers and cominators.<br/>  <br/></p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>With the method provided by Peasy, you can parse any object which is not only text, but also array, embedded list,
binary stream, or other data structures, like tree, graph, and so on.<br/></p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h6">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h6>Nothing but the method in Peasy is indispensable:<br/></h6>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <ul>
<li>If there is no left recursive symbol, you can remove the code about that(mainly refer to the function <code>recursive</code> and 20 lines).<br/></li>
<li>If you don&#39;t need memorize the parsed result, you can remove the stuffs about
memorization(mainly refer to the function <code>memorize</code>).<br/></li>
<li>The matchers(e.g. spaces, literal, identifier, etc.) and combinators(e.g. andp, orp, etc) in this module exists just
for demostrating the method initiated by Peasy. You will see they are all very simple, after seeing them, I bet
that you would rather to remove them and write them by hand yourself when you write the grammar rules.<br/><br/></li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>The notation <em>@name</em> below means a parameter. <br/>
all occurences of <em>@info</em> refer to the parsed object and the cursor, e.g. it&#39;s initial value can be {data: text, cursor:0}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
hasOwnProperty = Object.hasOwnProperty</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>A <em>matcher</em> is a function which matches the data being parsed and move cursor directly.<br/></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">isMatcher</span></span> = (item) -&gt;  <span class="keyword">typeof</span>(item)==<span class="string">"function"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>setup data structures in <em>@rules</em> for left recursive symbols and memorized symbols</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">setupGrammar</span></span> = (info, rules) -&gt;
  rules.parseCache = {}
  rules.__parsingSymbols = {}
  <span class="keyword">if</span> rules.__originalRules <span class="keyword">then</span> <span class="keyword">return</span> rules
  originalRules = rules.__originalRules = {}
  recursiveSymbols = rules.__leftRecursives
  <span class="keyword">if</span> recursiveSymbols
    <span class="keyword">for</span> symbol <span class="keyword">in</span> recursiveSymbols
      originalRules[symbol] = rules[symbol]
      rules[symbol] = recursive(info, rules, symbol)
  memorizeSymbols = rules.__memorizeSymbols
  <span class="keyword">if</span> memorizeSymbols
    <span class="keyword">for</span> symbol <span class="keyword">in</span> memorizeSymbols
      originalRules[symbol] = rules[symbol]
      rules[symbol] = memorize(info, rules, symbol)
  rules</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><em>recursive</em>: this is the key function to left recursive.<br/>
Make <em>@symbol</em> a left recursive symbol, which means to wrap <code>@originalRules[symbol]</code> with recursive.
when recursiv(info, rules, symbol)(start) is executed, loop computing rule(start) until no changes happened</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">recursive</span></span> = (info, rules, symbol) -&gt;
  rule = rules.__originalRules[symbol]
  (start) -&gt;
    hash = symbol+start
    callPath = rules.__parsingSymbols[start] ?= []
    <span class="keyword">if</span> symbol <span class="keyword">not</span> <span class="keyword">in</span> callPath
      callPath.push(symbol)
      m = rules.parseCache[hash] ?= [<span class="literal">undefined</span>, start]
      <span class="keyword">while</span> <span class="number">1</span>
        result = rule(start)
        <span class="keyword">if</span> <span class="keyword">not</span> result <span class="keyword">then</span> result = m[<span class="number">0</span>]; info.cursor = m[<span class="number">1</span>]; <span class="keyword">break</span>
        <span class="keyword">if</span> m[<span class="number">1</span>]==info.cursor <span class="keyword">then</span> m[<span class="number">0</span>] = result; <span class="keyword">break</span>
        <span class="keyword">else</span> m[<span class="number">0</span>] = result; m[<span class="number">1</span>] = info.cursor
      callPath.pop()
      result
    <span class="keyword">else</span>
      m = rules.parseCache[hash]
      info.cursor = m[<span class="number">1</span>]
      m[<span class="number">0</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><em>memorize</em>: memorize result and @cursor for <em>@symbol</em> which is not left recursive.<br/>
<em>The symbols which is left recursive should be wrapped by <code>recursive(symbol)</code>, not <code>memorize(symbol)</code>!!!</em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">memorize</span></span> = (info, rules, symbol) -&gt;
  tag = rules.symbolToTagMap[symbol]
  rule = rules.__originalRules[symbol]
  parseCache = rules.parseCache
  (start) -&gt;
    hash = tag+start
    m = parseCache[hash]
    <span class="keyword">if</span> m <span class="keyword">then</span> info.cursor = m[<span class="number">1</span>]; m[<span class="number">0</span>]
    <span class="keyword">else</span>
      result = rule(start)
      parseCache[hash] = [result, info.cursor]
      result</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><em>setMemoTag</em>: find a shorter part of symbol as the head of hash tag to index <em>@parseCache</em> <br/>
It exists just for performance reason. If you don&#39;t like this idea, you can remove the stuffs about memo tag yourself and
just use symbol itself as the head of hash tag.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">setMemoTag</span></span> = (rules, symbol) -&gt;
  i = <span class="number">1</span>
  <span class="keyword">while</span> <span class="number">1</span>
    <span class="keyword">if</span> hasOwnProperty.call(rules.tags, symbol.slice(<span class="number">0</span>, i)) <span class="keyword">then</span> i++
    <span class="keyword">else</span> <span class="keyword">break</span>
  tag = symbol.slice(<span class="number">0</span>, i)
  rules.symbolToTagMap[symbol] = tag
  rules.tags[tag] = <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h4>matchers and combinators<br/></h4>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>A <em>matcher</em> is a function which matches the data being parsed and move cursor directly.<br/>
All matcher should return truth value on succeed, and return falsic value on fail.<br/>
A <em>combinator</em> is a function which receive zero or more matchers as parameter(maybe plus some other parameters
which are not matchers), and generate a new matchers.<br/>
there are other matcher generator besides the standard combinators described as above, like <code>recursive</code>, <code>memo</code>, <code>memorize</code>,
which we have met above.</p>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>combinator <em>andp</em><br/>
execute item(info.cursor) in sequence, return the result of the last one. <br/>
when <code>andp</code> is used to combined of the matchers, the effect is the same as by using the Short-circuit evaluation, like below:<br/>
<code>item1(start) and item2(info.cursor] ... and itemn(info.cursor).</code>  <br/>
In fact, you maybe would rather like to use <code>item1(start) and item2(info.cursor) ..</code> when you write the grammar rule in the
manner of Peasy. That would be simpler, faster and more elegant. <br/>
And in that manner, you would have more control on your grammar rule, say like below: <br/>
<code>if (x=item1(start) and (x&gt;100) and item2(info.cursor) and not item3(info.cursor) and (y = item(info.cursor)) then doSomething()</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">andp</span></span> = (info, items...) -&gt;
  items = <span class="keyword">for</span> item <span class="keyword">in</span> items
    <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> literal(info, item) <span class="keyword">else</span> item
  (start) -&gt;
    info.cursor = start
    <span class="keyword">for</span> item <span class="keyword">in</span> items
      <span class="keyword">if</span> <span class="keyword">not</span>(result = item(info.cursor)) <span class="keyword">then</span> <span class="keyword">return</span>
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>combinator <em>orp</em> <br/>
execute <code>item(start)</code> one by one, until the first item which is evaluated to truth value and return the value.<br/>
when orp is used to combined of the matchers, the effect is the same as by using the Short-circuit evaluation, like below:<br/>
item1(start) or item2(info.cursor] ... or itemn(info.cursor) <br/>
In fact, you maybe would rather like to use <code>item1(start) or item2(info.cursor) ..</code> when you write the grammar rule in the
manner of Peasy. That would be simpler, faster and more elegant. <br/>
And in that manner, you would have more control on your grammar rule, say like below: <br/>
<code>if ((x=item1(start) and (x&gt;100)) or (item2(info.cursor) and not item3(info.cursor)) or (y = item(info.cursor)) then doSomething()</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">orp</span></span> = (info, items...) -&gt;
  items = <span class="keyword">for</span> item <span class="keyword">in</span> items
    <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> literal(infor, item) <span class="keyword">else</span> item
  (start) -&gt;
    <span class="keyword">for</span> item <span class="keyword">in</span> items
      info.cursor = start
      <span class="keyword">if</span> result = item(start) <span class="keyword">then</span> <span class="keyword">return</span> result
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>combinator <em>notp</em><br/>
<code>notp</code> is not useful except being used in other combinators, just like this = <code>andp(item1, notp(item2))</code>.<br/>
<em>It&#39;s unnessary, low effecient and ugly to write <code>notp(item)(start)</code>, just write <code>not item(start)</code>.</em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">notp</span></span> = (info, item) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> item = literal(info, item)
  (start) -&gt; <span class="keyword">not</span> item(start)</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>combinator <em>any</em>: zero or more times of <code>item(info.cursor)</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">any</span></span> = (info, item) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> item = literal(info, item)
  (start) -&gt;
    result = []; info.cursor = start
    <span class="keyword">while</span> ( x = item(info.cursor)) <span class="keyword">then</span> result.push(x)
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>combinator <em>some</em>: one or more times of <code>item(info.cursor)</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">some</span></span> = (info, item) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> item = literal(info, item)
  (start) -&gt;
    result = []; info.cursor = start
    <span class="keyword">if</span> <span class="keyword">not</span> (x = item(info.cursor)) <span class="keyword">then</span> <span class="keyword">return</span> x
    <span class="keyword">while</span> <span class="number">1</span>
      result.push(x)
      x = item(info.cursor)
      <span class="keyword">if</span> <span class="keyword">not</span> x <span class="keyword">then</span> <span class="keyword">break</span>
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>combinator  <em>may</em>: a.k.a optional <br/>
try to match <code>item(info.cursor)</code>, wether <code>item(info.cursor)</code> succeed or not, <code>maybe(item)(start)</code> succeed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">may</span></span> = (info, item) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> item = literal(info, item)
  (start) -&gt;
    info.cursor = start
    <span class="keyword">if</span> x = item(info.cursor) <span class="keyword">then</span> x
    <span class="keyword">else</span> info.cursor = start; <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>combinator <em>follow</em> <br/>
try to match <code>item(start)</code>, if succeed, reset info.cursor and return the value of item(start) <br/>
whether succeed or not, info.cursor is reset to start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">follow</span></span> = (info, item) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> item = literal(info, item)
  (start) -&gt;
    info.cursor = start
    <span class="keyword">if</span> x = item(info.cursor) <span class="keyword">then</span> info.cursor = start; x</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>combinator <em>times</em>: match <em>@n</em> times item(info.cursor), n&gt;=1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">times</span></span> = (info, item, n) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> item = literal(info, item)
  (start) -&gt;
    info.cursor = start; i = <span class="number">0</span>
    <span class="keyword">while</span> i++&lt;n
      <span class="keyword">if</span> x = item(info.cursor) <span class="keyword">then</span> result.push(x)
      <span class="keyword">else</span> <span class="keyword">return</span>
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>combinator <em>seperatedList</em>: some times item(info.cursor), separated by info.separator</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">seperatedList</span></span> = (info, item, separator=spaces) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> item = literal(info, item)
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(separator) <span class="keyword">then</span> separator = literal(separator)
  (start) -&gt;
    info.cursor = start
    result = []
    x = item(info.cursor)
    <span class="keyword">if</span> <span class="keyword">not</span> x <span class="keyword">then</span> <span class="keyword">return</span>
    <span class="keyword">while</span> <span class="number">1</span>
      result.push(x)
      <span class="keyword">if</span> <span class="keyword">not</span>(x = item(info.cursor)) <span class="keyword">then</span> <span class="keyword">break</span>
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>combinator <em>timesSeperatedList</em>: given info.n times @item separated by info.separator, n&gt;=1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">timesSeperatedList</span></span> = (info, item, n, separator=spaces) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> item = literal(info, item)
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(separator) <span class="keyword">then</span> separator = literal(separator)
  (start) -&gt;
    info.cursor = start
    result = []
    x = item(info.cursor)
    <span class="keyword">if</span> <span class="keyword">not</span> x <span class="keyword">then</span> <span class="keyword">return</span>
    i = <span class="number">1</span>
    <span class="keyword">while</span> i++&lt;n
      result.push(x)
      <span class="keyword">if</span> <span class="keyword">not</span>(x = item(info.cursor)) <span class="keyword">then</span> <span class="keyword">break</span>
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>As the same as andp, orp, in the manner of Peasy, you would rather to write youself a loop to do the things, instead
of useing the combinators like any, some, times, seperatedList,etc. and that would be simpler, faster and more elegant. <br/>
And in that manner, you would have more control on your grammar rule so that we can do other things include lexer,
error report, errer recovery, semantic operatons, and any other things you would like to do. <br/></p>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>It is for three motives to put all of the stuffs abve here:
<em> 1. to demonstrate how to write matcher and grammar rules in the method brought by Peasy
</em> 2. to demonstrate that Peasy can also implement any component that other combinational parser libaries like pyparsing,
parsec, but in a simpler, faster manner.
* 3. to show that it is how easy to write the combinators in the manner of Peasy.<br/><br/></p>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>As you have seen above, all of these utilities is so simple that you can write them at home by hand easily. In fact,
you can write yourself all of the grammar rules in the same manner as above.</p>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>If you like, you can add a faster version for every matcher, which do not pass <em>@start</em> as parameter around.<br/>
Some of the matchers below have two version, to demonstrate how to do that.
<em>Don&#39;t use the faster version in orp, any, some, times, separatedList, timesSeparatedList.</em> <br/><br/></p>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h4>other predicates, matchers, and combinators <br/></h4>
<p>below is some little utilities which may be useful. Some of them is provided with both normal and faster version.<br/>
just remove them if you don&#39;t need them, except <em>literal</em>, which is depended by the combinators above.</p>

            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>predicate
A <em>predicate</em> is a function which return true or false.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">isdigit</span></span> = (c) -&gt; <span class="string">'0'</span>&lt;=c&lt;=<span class="string">'9'</span>
exports.<span class="function"><span class="title">isletter</span></span> = (c) -&gt; <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span>
exports.<span class="function"><span class="title">islower</span></span> = (c) -&gt; <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span>
exports.<span class="function"><span class="title">isupper</span></span> = (c) -&gt;<span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span>
exports.<span class="function"><span class="title">isIdentifierLetter</span></span> = (c) -&gt; <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">or</span> <span class="string">'0'</span>&lt;=c&lt;=<span class="string">'9'</span> <span class="keyword">or</span> <span class="string">'c'</span>==<span class="string">'@'</span> <span class="keyword">or</span> <span class="string">'c'</span>==<span class="string">'_'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>matcher <em>literal</em>, normal version<br/>
match a text string.<br/>
`notice = some combinators like andp, orp, notp, any, some, etc. use literal to wrap a object which is not a matcher.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">literal</span></span> = (info, string) -&gt; (start) -&gt;
  len = string.length
  <span class="keyword">if</span> info.data.slice(start, stop = start+len)==string <span class="keyword">then</span> info.cursor = stop; <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>matcher <em>literal_</em>, faster version<br/>
match a text string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">literal_</span></span> = (info, string) -&gt; (start) -&gt;
  len = string.length
  <span class="keyword">if</span> info.data.slice(info.cursor,  stop = info.cursor+len)==string <span class="keyword">then</span> info.cursor = stop; <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>matcher <em>char</em>, normal version<br/>
match one character</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.char = <span class="function"><span class="title">char</span></span> = (info, c) -&gt; (start) -&gt; <span class="keyword">if</span> info.data[start]==c <span class="keyword">then</span> info.cursor = start+<span class="number">1</span>; <span class="keyword">return</span> c</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>matcher <em>char_</em>, normal version <br/>
match one character</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">char_</span></span> = (info, c) -&gt; () -&gt; <span class="keyword">if</span> info.data[info.cursor]==c <span class="keyword">then</span> info.cursor++; <span class="keyword">return</span> c</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>In spaces, spaces<em>, spaces1, spaces1</em>, a tat(&#39;\t&#39;) is seen as tabWidth spaces, <br/>
which is used in indent style language, such as coffeescript, python, haskell, etc. <br/>
If you don&#39;t need this feature, you can easily rewrite these utilities to remove the code about tab width yourself.<br/><br/></p>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>matcher <em>spaces</em>, normal version<br/>
zero or more whitespaces, ie. space or tab.<br/></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">spaces</span></span> = (info) -&gt; (start) -&gt;
  len = <span class="number">0</span>
  info.cursor = start
  <span class="keyword">while</span> <span class="number">1</span>
    <span class="keyword">switch</span> info.data[info.cursor++]
      <span class="keyword">when</span> <span class="string">' '</span> <span class="keyword">then</span> len++
      <span class="keyword">when</span> <span class="string">'\t'</span> <span class="keyword">then</span> len += tabWidth
      <span class="keyword">else</span> <span class="keyword">break</span>
  <span class="keyword">return</span> len</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>matcher <em>spaces_</em>, faster version<br/>
zero or more whitespaces, ie. space or tab.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">spaces_</span></span> = (info) -&gt; () -&gt;
  len = <span class="number">0</span>
  <span class="keyword">while</span> <span class="number">1</span>
    <span class="keyword">switch</span> info.data[info.cursor++]
      <span class="keyword">when</span> <span class="string">' '</span> <span class="keyword">then</span> len++
      <span class="keyword">when</span> <span class="string">'\t'</span> <span class="keyword">then</span> len += tabWidth
      <span class="keyword">else</span> <span class="keyword">break</span>
  len</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>matcher <em>spaces1</em>, normal version<br/>
one or more whitespaces, ie. space or tab.<br/></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">spaces1</span></span> = (info) -&gt; (start) -&gt;
  len = <span class="number">0</span>
  info.cursor = start
  <span class="keyword">while</span> <span class="number">1</span>
    <span class="keyword">switch</span> info.data[info.cursor++]
      <span class="keyword">when</span> <span class="string">' '</span> <span class="keyword">then</span> len++
      <span class="keyword">when</span> <span class="string">'\t'</span> <span class="keyword">then</span> len += tabWidth
      <span class="keyword">else</span> <span class="keyword">break</span>
  <span class="keyword">if</span> len <span class="keyword">then</span> <span class="keyword">return</span> info.cursor = info.cursor; len</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>matcher <em>spaces1_</em>, faster version<br/>
one or more whitespaces, ie. space or tab.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">spaces1_</span></span> = (info) -&gt; () -&gt;
  len = <span class="number">0</span>
  info.cursor = start
  <span class="keyword">while</span> <span class="number">1</span>
    <span class="keyword">switch</span> info.data[info.cursor++]
      <span class="keyword">when</span> <span class="string">' '</span> <span class="keyword">then</span> len++
      <span class="keyword">when</span> <span class="string">'\t'</span> <span class="keyword">then</span> len += tabWidth
      <span class="keyword">else</span> <span class="keyword">break</span>
  <span class="keyword">if</span> len <span class="keyword">then</span> <span class="keyword">return</span> info.cursor = info.cursor; len</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>matcher <em>wrap</em>, normal version<br/>
match left, then match item, match right at last</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">wrap</span></span> = (info) -&gt; (item, left=spaces, right=spaces) -&gt;
  <span class="keyword">if</span> <span class="keyword">not</span> isMatcher(item) <span class="keyword">then</span> item = literal(info, item)
  (start) -&gt;
     <span class="keyword">if</span> left(start) <span class="keyword">and</span> result = item(info.cursor) <span class="keyword">and</span> right(info.cursor) <span class="keyword">then</span> result</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>matcher <em>identifierLetter</em> = normal version<br/>
is a letter than can be used in identifer?<br/>
javascript style, &#39;@&#39; is a identifierLetter_<br/></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">identifierLetter</span></span> = (info) -&gt; (start) -&gt;
  start = info.cursor
  c = info.data[info.cursor]
  <span class="keyword">if</span> c <span class="keyword">is</span> <span class="string">'@'</span> <span class="keyword">or</span> c <span class="keyword">is</span> <span class="string">'_'</span> <span class="keyword">or</span> <span class="string">'a'</span>&lt;=c&lt;<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">or</span> <span class="string">'0'</span>&lt;=c&lt;=<span class="string">'9'</span>
    info.cursor++; <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>matcher <em>identifierLetter_</em>, version<br/>
is a letter that can be used in identifer? <br/>
javascript style, &#39;@&#39; is a identifierLetter_</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">identifierLetter_</span></span> = (info) -&gt; () -&gt;
  c = info.data[info.cursor]
  <span class="keyword">if</span> c <span class="keyword">is</span> <span class="string">'@'</span> <span class="keyword">or</span> c <span class="keyword">is</span> <span class="string">'_'</span> <span class="keyword">or</span> <span class="string">'a'</span>&lt;=c&lt;<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">or</span> <span class="string">'0'</span>&lt;=c&lt;=<span class="string">'9'</span>
    info.cursor++; <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>matcher <em>followIdentifierLetter_</em>, faster version<br/>
lookahead whether the following character is a letter used in identifer. don&#39;t change info.cursor. <br/>
javascript style, &#39;@&#39; is a identifierLetter_</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">followIdentifierLetter_</span></span> = (info) -&gt; () -&gt;
  c = info.data[info.cursor]
  c <span class="keyword">is</span> <span class="string">'@'</span> <span class="keyword">or</span> c <span class="keyword">is</span> <span class="string">'_'</span> <span class="keyword">or</span> <span class="string">'a'</span>&lt;=c&lt;<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">or</span> <span class="string">'0'</span>&lt;=c&lt;=<span class="string">'9'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>matcher digit_, normal version<br/></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">digit</span></span> = (info) -&gt; (start) -&gt; c = info.data[start];  <span class="keyword">if</span> <span class="string">'0'</span>&lt;=c&lt;=<span class="string">'9'</span> <span class="keyword">then</span> info.cursor = start+<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>matcher digit_, faster version<br/></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">digit_</span></span> = (info) -&gt; () -&gt; c = info.data[info.cursor];  <span class="keyword">if</span> <span class="string">'0'</span>&lt;=c&lt;=<span class="string">'9'</span> <span class="keyword">then</span> info.cursor++</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>matcher letter, normal version<br/></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">letter</span></span> = (info) -&gt; (start) -&gt; c = info.data[start]; <span class="keyword">if</span> <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">then</span> info.cursor = start+<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>matcher letter, faster version<br/></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">letter_</span></span> = (info) -&gt; () -&gt; c = info.data[info.cursor]; <span class="keyword">if</span> <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">then</span> info.cursor++</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>matcher lower, normal version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">lower</span></span> = (info) -&gt; (start) -&gt; c = info.data[start]; <span class="keyword">if</span> <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span> <span class="keyword">then</span> info.cursor = start+<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>matcher lower_, faster version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">lower_</span></span> = (info) -&gt; () -&gt; c = info.data[info.cursor]; <span class="keyword">if</span> <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span> <span class="keyword">then</span> info.cursor++</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>matcher upper, normal version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">upper</span></span> = (info) -&gt; (start) -&gt;  c = info.data[start]; <span class="keyword">if</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">then</span> info.cursor = start+<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>matcher upper_, faster version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">upper_</span></span> = (info) -&gt; () -&gt; c = info.data[info.cursor]; <span class="keyword">if</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">then</span> info.cursor++</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>matcher identifier, normal version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">identifier</span></span> = (info) -&gt; (start) -&gt;
  info.cursor = start
  c = info.data[info.cursor]
  <span class="keyword">if</span> <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">or</span> <span class="string">'c'</span>==<span class="string">'@'</span> <span class="keyword">or</span> <span class="string">'c'</span>==<span class="string">'_'</span> <span class="keyword">then</span> info.cursor++
  <span class="keyword">else</span> <span class="keyword">return</span>
  <span class="keyword">while</span> <span class="number">1</span>
    c = info.data[info.cursor]
    <span class="keyword">if</span> <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">or</span> <span class="string">'0'</span>&lt;=c&lt;=<span class="string">'9'</span> <span class="keyword">or</span> <span class="string">'c'</span>==<span class="string">'@'</span> <span class="keyword">or</span> <span class="string">'c'</span>==<span class="string">'_'</span> <span class="keyword">then</span> info.cursor++
    <span class="keyword">else</span> <span class="keyword">break</span>
  <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>matcher identifier_, faster version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">identifier_</span></span> = (info) -&gt; () -&gt;
  c = info.data[info.cursor]
  <span class="keyword">if</span> <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">or</span> <span class="string">'c'</span>==<span class="string">'@'</span> <span class="keyword">or</span> <span class="string">'c'</span>==<span class="string">'_'</span> <span class="keyword">then</span> info.cursor++
  <span class="keyword">else</span> <span class="keyword">return</span>
  <span class="keyword">while</span> <span class="number">1</span>
    c = info.data[info.cursor]
    <span class="keyword">if</span> <span class="string">'a'</span>&lt;=c&lt;=<span class="string">'z'</span> <span class="keyword">or</span> <span class="string">'A'</span>&lt;=c&lt;=<span class="string">'Z'</span> <span class="keyword">or</span> <span class="string">'0'</span>&lt;=c&lt;=<span class="string">'9'</span> <span class="keyword">or</span> <span class="string">'c'</span>==<span class="string">'@'</span> <span class="keyword">or</span> <span class="string">'c'</span>==<span class="string">'_'</span> <span class="keyword">then</span> info.cursor++
    <span class="keyword">else</span> <span class="keyword">break</span>
  <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>The utilites above is just for providing some examples on how to write matchers for Peasy.<br/>
In fact, It&#39;s realy easy peasy to write the matchers for your grammar rule yourself.<br/>
see <a href="http://en.wiktionary.org/wiki/easy_peasy">easy peasy</a> <br/></p>

            </div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p><a id="peasysample"></a>
<em>parse</em>: this is a sample parse function to demonstrate on how to write your own grammar rules yourself.<br/>
notice that there exists indirect left recursion in the rules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">parse</span></span> = (text) -&gt;
  <span class="function"><span class="title">makeGrammar</span></span> = (info) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>generate the matchers by the combinators in advance for better performance.<br/>
if you don&#39;t mind performance, you can write them in the rule directly.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    a = char(info, <span class="string">'a'</span>); b = char(info, <span class="string">'b'</span>); x = char(info, <span class="string">'x'</span>); z = char(info, <span class="string">'z'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>the grammar rules object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    rules =
      Root: (start) -&gt; (m = rules.A(start)) <span class="keyword">and</span> z(info.cursor) <span class="keyword">and</span> m+<span class="string">'z'</span>
      A: (start) -&gt;
        (m =  rules.B(start)) <span class="keyword">and</span> x(info.cursor) <span class="keyword">and</span> m+<span class="string">'x'</span> <span class="keyword">or</span> m\
        <span class="keyword">or</span> a(start)
      B: (start) -&gt;(m = rules.A(start))  <span class="keyword">and</span> y(info.cursor) <span class="keyword">and</span> m+<span class="string">'y'</span><span class="keyword">or</span> rules.C(start)
      C: (start) -&gt; rules.A(start) <span class="keyword">or</span> b(start)
      __leftRecursives: [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>]
    exports.setupGrammar(info, rules)
  grammar = makeGrammar({data:text, cursor:<span class="number">0</span>})
  grammar.Root(<span class="number">0</span>)</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
